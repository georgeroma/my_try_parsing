(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function _iterableToArrayLimit(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,s,a=[],o=!0,i=!1;try{for(r=r.call(t);!(o=(n=r.next()).done)&&(a.push(n.value),!e||a.length!==e);o=!0);}catch(t){i=!0,s=t}finally{try{o||null==r.return||r.return()}finally{if(i)throw s}}return a}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function asyncGeneratorStep(t,e,r,n,s,a,o){try{var i=t[a](o),u=i.value}catch(t){return void r(t)}i.done?e(u):Promise.resolve(u).then(n,s)}function _asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise(function(n,s){var a=t.apply(e,r);function o(t){asyncGeneratorStep(a,n,s,o,i,"next",t)}function i(t){asyncGeneratorStep(a,n,s,o,i,"throw",t)}o(void 0)})}}!function(){var t=function(){function t(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.rootElement=t instanceof Element?t:document.querySelector(t),this.settings=this.$helper.deepMerge({},{loadWhenVisible:!0,fetchUrl:"/recommendations/top-sale",imageSize:"c516x688",sliderSlr:".j-carousel",visibleCount:5,loop:!0,needDenom:!0,sameWindow:!0},e),this._bindEvents()}var e=t.prototype;return e.destroy=function(){this.observer&&this.observer.unobserve(this.rootElement),window.removeEventListener("scroll",this._onScrollLoad)},e.showWhenInViewPortAsync=function(){var t=this;if(this.$apiSupport.intersectionObserver)this.observer=new IntersectionObserver(function(e,r){e.forEach(function(e){var n=e.isIntersecting,s=e.intersectionRatio;(n||s>0)&&(t.showAsync(),r.unobserve(t.rootElement))})},{rootMargin:"100px"}),this.observer.observe(this.rootElement);else{var e=this.rootElement.getBoundingClientRect().top;document.documentElement.clientHeight>e?this.showAsync():(this._onScrollLoad=this.$helper.throttle(function(){window.pageYOffset>=e-500&&(window.removeEventListener("scroll",t._onScrollLoad),t.showAsync())},300),window.addEventListener("scroll",this._onScrollLoad))}return this},e.showAsync=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(){var e,r,n,s,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Promise.all([this._loadRequiredTemplate(),this._loadGoodsAsync(),this._loadRequiredModules()]);case 3:if(e=t.sent,r=_slicedToArray(e,2),n=r[0],(s=r[1])&&s.goods&&s.goods.length){t.next=9;break}return t.abrupt("return");case 9:if(!this.settings.fillPrices){t.next=16;break}return t.next=12,this._fillGoodsAsync(s.nms,s.goods);case 12:if((a=t.sent)&&a.length){t.next=15;break}return t.abrupt("return");case 15:s.goods=a;case 16:this._show(s,n),"function"==typeof this.settings.onCarouselShow&&this.settings.onCarouselShow.call(this),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(0),console.error(t.t0.message);case 23:case"end":return t.stop()}},t,this,[[0,20]])}));return function(){return t.apply(this,arguments)}}(),e._show=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(e,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.recommendations=e,r.link(this.rootElement,this.$helper.deepMerge(Object.create(WbSpaModel.prototype),e,this.settings)),this.rootElement.querySelector(".j-b-slider-wrapper").classList.remove("hide"),this.settings.sendStats&&this._statsSendShow(),this._showCarouselWba();case 5:case"end":return t.stop()}},t,this)}));return function(e,r){return t.apply(this,arguments)}}(),e._loadRequiredModules=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.$moduleLoader.loadModuleAsync("swiper",!0));case 1:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),e._loadRequiredTemplate=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.template);case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),e._loadGoodsAsync=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!Array.isArray(this.settings.products)){t.next=4;break}return t.abrupt("return",{goods:this.settings.products});case 4:if(!this.settings.byNms){t.next=10;break}return t.next=7,this._loadGoodsByNmsAsync();case 7:return t.abrupt("return",t.sent);case 10:if(!this.settings.isFinishLook){t.next=16;break}return t.next=13,this._loadGoodsFinishLook();case 13:return t.abrupt("return",t.sent);case 16:if("function"!=typeof this.settings.loadItemsCustom){t.next=22;break}return t.next=19,this.settings.loadItemsCustom(this.settings);case 19:return t.abrupt("return",t.sent);case 22:if(!this.settings.isPromo){t.next=28;break}return t.next=25,this._loadPromoGoods();case 25:return t.abrupt("return",t.sent);case 28:if(!this.settings.fetchUrl){t.next=32;break}return t.next=31,this._loadGoodsByUrl();case 31:return t.abrupt("return",t.sent);case 32:return t.next=34,this._loadGoodsDefault();case 34:return t.abrupt("return",t.sent);case 35:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),e._loadGoodsByNmsAsync=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(){var e,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._loadNmsAsync();case 2:if((e=t.sent)&&0!=e.length){t.next=5;break}return t.abrupt("return",null);case 5:return r=e.map(function(t){return{cod1S:t}}),t.next=8,wb.xnm.fillPrice(r,void 0);case 8:return t.abrupt("return",r.filter(function(t){return null!=t.name}));case 9:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),e._loadGoodsFinishLook=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==this.settings.nmIds&&0!==this.settings.nmIds.length){t.next=2;break}return t.abrupt("return",null);case 2:return t.next=4,wb.xnm.getGoodsForRecommend(this.settings.nmIds);case 4:return e=t.sent,t.abrupt("return",{goods:e});case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),e._loadPromoGoods=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(){var e,r,n,s,a,o=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return[],t.prev=1,n=new URL(this.settings.fetchUrl,window.location.origin),Object.keys(this.settings.query).forEach(function(t){return n.searchParams.append(t,o.settings.query[t])}),t.next=6,this.$httpClient.fetchJSON(n.toString());case 6:if(!((null==(s=t.sent)?void 0:null===(e=s.adsCarousel)||void 0===e?void 0:e.length)>0)){t.next=14;break}return a=s.adsCarousel.map(function(t){return t.nmId}),this.settings.advertCarouselStatParams=s.adsCarousel,this.settings.productId=this.settings.query.nmId,t.next=13,wb.xnm.getGoodsForRecommendAndCatalog(a);case 13:this.products=t.sent;case 14:if(!((null===(r=this.products)||void 0===r?void 0:r.length)>0)){t.next=18;break}return t.abrupt("return",{goods:this.products});case 18:return t.abrupt("return",null);case 19:t.next=25;break;case 21:return t.prev=21,t.t0=t.catch(1),console.error("can't load goods"),t.abrupt("return",null);case 25:case"end":return t.stop()}},t,this,[[1,21]])}));return function(){return t.apply(this,arguments)}}(),e._loadGoodsByUrl=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(){var e,r,n,s=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=null,r=new URL(this.settings.fetchUrl,window.location.origin),this.settings.query&&Object.keys(this.settings.query).forEach(function(t){return r.searchParams.append(t,s.settings.query[t])}),t.next=5,this.$httpClient.fetchJSON(r.toString());case 5:if(!(n=t.sent).nmIds){t.next=10;break}return t.next=9,wb.xnm.getGoodsForRecommend(n.nmIds);case 9:e=t.sent;case 10:return t.abrupt("return",{goods:e});case 11:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),e._loadGoodsDefault=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.$httpClient.fetchJSON("/recommendations/providers"),t.abrupt("return",e[0]);case 2:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),e._fillGoodsAsync=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(e,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=e.map(function(t){return{cod1S:t}}),t.prev=1,t.next=4,wb.xnm.fillPrice(e,void 0);case 4:return t.abrupt("return",e.filter(function(t){return t.price>0}));case 7:return t.prev=7,t.t0=t.catch(1),t.abrupt("return",r);case 10:case"end":return t.stop()}},t,null,[[1,7]])}));return function(e,r){return t.apply(this,arguments)}}(),e._loadNmsAsync=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$httpClient.fetchJSON("/recommendations/providers",{method:"POST",body:this.$helper.objectSerializer({recommendations:[{location:this.settings.type,markupBlock:this.settings.markupBlock,orderedGoodsIds:this.settings.nmIds}]})});case 2:return e=t.sent,t.abrupt("return",e[0]);case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),e._bindEvents=function(){var t=this;this.rootElement.addEventListener("click",this.$helper.delegator(".j-open-product-popup",function(e,r){e.preventDefault(),e.stopPropagation();var n=r.closest(".j-product-item");t.$moduleLoader.loadModuleAsync("productCardPopup").then(function(e){var r=document.querySelectorAll(".j-product-item").toArray();new e(e.data,e.template).showSlider({cod1S:n.dataset.popupNmId,newTargetUrl:t.settings.target||t.settings.targetUrl||"MI",onSlideMove:t._onPopupSlideMove.bind(t),disableFullButton:t.settings.popupDisableFullButton},r,r.findIndex(function(t){return t==n}))}).catch(function(t){console.log(t.message),window.location.href=r.href})})),this.rootElement.addEventListener("click",this.$helper.delegator("a",function(e,r){var n=r.closest(".j-product-item");if(t._clickCarouselWba(r,n),r.dataset.seeAll)t.settings.isPromo&&sessionStorage.putObject("promogoods_for_KT",t.products);else{if(t.settings.sendStats&&t._statsSendClick(n.dataset.popupNmId),t.settings.analiticsCode){var s=null==n?0:t.recommendations.goods.findIndex(function(t){return t.cod1S==n.dataset.popupNmId});t.$analitic.saveState({l:t.settings.analiticsCode,iid:s+1,t:t.settings.productId})}"function"==typeof t.settings.onItemClick&&t.settings.onItemClick.call(t)}}))},e._onPopupSlideMove=function(t){this.settings.sendStats&&this._statsSendClick(t),this.settings.sendStats&&this._statsSendShowByCards(t)},e._sendCarouselWbaEvent=function(t,e,r,n){this.$analitic.sendCarouselWbaEvent(t,e,r,n,0)},e._showCarouselWba=function(){this._sendCarouselWbaEvent("Carousel_S",this.settings.analiticsCode,0,0)},e._clickCarouselWba=function(t,e){var r=!!t.dataset.seeAll,n=r?"Carousel_All":"Carousel_T";r?this._sendCarouselWbaEvent(n,this.settings.analiticsCode,0,0):this._sendCarouselWbaEvent(n,this.settings.analiticsCode,null==e?void 0:e.dataset.analiticsIid,null==e?void 0:e.dataset.popupNmId)},e._statsSendClick=function(t){var e=[];if(this.settings.advertCarouselStatParams){var r=this.settings.advertCarouselStatParams.filter(function(e){return e.nmId==t});if(!r||0==r.length)return;r=r[0],e.push(wb.stat.wrapParam("C1S",this.settings.productId)),e.push(wb.stat.wrapParam("ADID",r.advertId)),e.push(wb.stat.wrapParam("NMID",t)),e.push(wb.stat.wrapParam("POS",r.position)),e.push(wb.stat.wrapParam("CPM",r.cpm)),e.push(wb.stat.wrapParam("SID",r.subjectId)),e.push(wb.stat.wrapParam("BRID",r.brandId)),wb.stat.sendEvent("APDC",e,!0)}else e.push(wb.stat.wrapParam("ADID",this.settings.advertisementId)),e.push(wb.stat.wrapParam("NMID",t)),wb.stat.sendEvent("ACC",e)},e._statsSendShow=function(){var t=[];this.settings.advertCarouselStatParams?this._statsSendShowByCards():(t.push(wb.stat.wrapParam("ADID",this.settings.advertisementId)),wb.stat.sendEvent("ACS",t))},e._statsSendShowByCards=function(t){var e,r=this;if(this.settings.advertCarouselStatParams&&0!=this.settings.advertCarouselStatParams.lenght){var n=document.querySelector(".j-promo-carousel-wrapper"),s=null==n?void 0:null===(e=n.querySelectorAll(".j-product-item:not(.".concat("j-shown-stat-sended",")")))||void 0===e?void 0:e.toArray();if(s&&0!=s.length){var a=this.settings.productId,o=this.settings.advertCarouselStatParams;if(t){var i=null;if(s.forEach(function(e){e.dataset.popupNmId!=t||(i=e)}),null==i)return;c(t),i.classList.add("j-shown-stat-sended")}else if(this.$apiSupport.intersectionObserver){var u={root:n,threshold:.5};this.advCardsObserver=new IntersectionObserver(function(t,e){t.forEach(function(t){if(t.isIntersecting){if(e.unobserve(t.target),t.target.classList.contains("j-shown-stat-sended"))return;c(t.target.dataset.popupNmId),t.target.classList.add("j-shown-stat-sended")}})},u),s.forEach(function(t){r.advCardsObserver.observe(t)})}else s.forEach(function(t){c(t.dataset.popupNmId),t.classList.add("j-shown-stat-sended")})}}function c(t){var e=o.filter(function(e){return e.nmId==t});if(e&&0!=e.length){e=e[0];var r=[];r.push(wb.stat.wrapParam("C1S",a)),r.push(wb.stat.wrapParam("ADID",e.advertId)),r.push(wb.stat.wrapParam("NMID",t)),r.push(wb.stat.wrapParam("POS",e.position)),r.push(wb.stat.wrapParam("CPM",e.cpm)),r.push(wb.stat.wrapParam("SID",e.subjectId)),r.push(wb.stat.wrapParam("BRID",e.brandId)),wb.stat.sendEvent("APDS",r)}}},t}();window.__spaModuleManager__.register("recommendationCarousel",t)}();

},{}]},{},[1]);
