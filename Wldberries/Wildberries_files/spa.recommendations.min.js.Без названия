(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";function ownKeys(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,r)}return o}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(o),!0).forEach(function(t){_defineProperty(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function asyncGeneratorStep(e,t,o,r,n,s,i){try{var a=e[s](i),l=a.value}catch(e){return void o(e)}a.done?t(l):Promise.resolve(l).then(r,n)}function _asyncToGenerator(e){return function(){var t=this,o=arguments;return new Promise(function(r,n){var s=e.apply(t,o);function i(e){asyncGeneratorStep(s,r,n,i,a,"next",e)}function a(e){asyncGeneratorStep(s,r,n,i,a,"throw",e)}i(void 0)})}}!function(){if($.views){var e=require("../services/basketRecomendationService");$.views.tags({recommendations:{dataBoundOnly:!0,mainElement:".j-b-recommended-goods-wrapper",displayElement:".j-b-recommended-goods-wrapper",template:'<div class="j-b-recommended-goods-wrapper"></div>',onUpdate:!1,getOptions:function(){var e,t,o,r,n={type:this.tagCtx.props.type,markupBlock:this.tagCtx.props.markupBlock,nmIds:this.tagCtx.props.nmIds,products:this.tagCtx.props.goods,title:this.tagCtx.props.title,isFinishLook:this.tagCtx.props.isFinishLook,fillPrices:this.tagCtx.props.fillPrices,loop:!!this.tagCtx.props.hasOwnProperty("circular")&&this.tagCtx.props.circular,slideMoveMode:null!==(e=this.tagCtx.props.slideMoveMode)&&void 0!==e?e:"visible",needDenom:null===(t=this.tagCtx.props.needDenom)||void 0===t||t,seeAllUrl:this.tagCtx.props.seeAllUrl,sameWindow:null===(o=this.tagCtx.props.sameWindow)||void 0===o||o,fetchUrl:this.tagCtx.props.fetchUrl,analiticsCode:this.tagCtx.props.analiticsCode,analiticsTerm:this.tagCtx.props.analiticsTerm,loadItemsCustom:this.tagCtx.props.loadItemsCustom,onCarouselShow:this.tagCtx.props.onCarouselShow,onlyPopup:this.tagCtx.props.onlyPopup,popupDisableFullButton:this.tagCtx.props.popupDisableFullButton,showRating:this.tagCtx.props.showRating,showButtons:this.tagCtx.props.showButtons,onVoteClick:this.tagCtx.props.onVoteClick,onItemClick:this.tagCtx.props.onItemClick,onBasketClick:this.tagCtx.props.onBasketClick,onPonedClick:this.tagCtx.props.onPonedClick,updateAnalytics:this.tagCtx.props.updateAnalytics,swiperThreshold:this.tagCtx.props.swiperThreshold,showAllSeparate:null!==(r=this.tagCtx.props.showAllSeparate)&&void 0!==r&&r};this.tagCtx.props.visible&&(n.visibleCount=this.tagCtx.props.visible),this.tagCtx.props.cod1S&&(n.cod1S=this.tagCtx.props.cod1S),this.tagCtx.props.targetUrl&&(n.target=this.tagCtx.props.targetUrl);var s={};for(var i in this.tagCtx.props)this.tagCtx.props.hasOwnProperty(i)&&0===i.indexOf("query_")&&(s[i.split("query_")[1]]=this.tagCtx.props[i]);return n.query=s,n},init:function(){var e=this;if(!this.inited)return this.inited=!0,this.ctx.root.$moduleLoader.loadModuleAsync("recommendationCarousel",!1).then(function(t,o){var r=e.getOptions();e.recommendationsCarousel=new t(e.mainElem[0],r).showWhenInViewPortAsync()})},onUnbind:function(){var e;null===(e=this.recommendationsCarousel)||void 0===e||e.destroy()}},basketRecommendations:{baseTag:"recommendations",init:function(t){var o=this;if(t.props.enabled){var r=t.props.nmIds,n=r.join(","),s=[],i=!1;t.props.loadItemsCustom=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(n){var a,l,p,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==n.nmIds&&0!==n.nmIds.length){t.next=2;break}return t.abrupt("return",null);case 2:if(a=o.getFromCache(r),l=[],!(a.length>0)){t.next=9;break}i=!0,l=s=a,t.next=13;break;case 9:return p=new e,t.next=12,p.get(n.nmIds);case 12:l=s=t.sent;case 13:if(0!==l.length){t.next=15;break}return t.abrupt("return",{goods:[]});case 15:return t.next=17,wb.xnm.getGoodsForRecommend(l,!1,!0,!0);case 17:return c=t.sent,t.abrupt("return",{goods:c});case 19:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),t.props.showRating=!0,t.props.showButtons=!0,t.props.onlyPopup=!0,t.props.popupDisableFullButton=!0,t.props.swiperThreshold=24;var a=function(e){o.ctx.root.$analitic.sendEvent(e,{cart_id:s.join(","),parent_id:n})},l=function(e){return _objectSpread({lw:"CR",targetUrl:e.targetUrl},o.ctx.root.$analitic.getState())};t.props.onBasketClick=function(e){var t,r=document.querySelector(".j-basket-form__content"),n=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,s=r.scrollHeight,i=$.view(e.target).data;o.ctx.root.$moduleLoader.loadModuleAsync("basketAdderHelper").then(function(e){e.addToBasket(i,l(i),{basketCustomEvent:function(){var e=r.scrollHeight-s;document.documentElement.scrollTop=n+e;var o=document.querySelector(".i-popup-list-of-sizes");o&&(t=t||o.offsetTop,o.style.top="".concat(t+e,"px"))}}).then(function(e){e&&$.observable(i).setProperty({addedToBasket:!0})})})},t.props.onPonedClick=function(e){var t=$.view(e.target).data;o.ctx.root.$moduleLoader.loadModuleAsync("basketAdderHelper").then(function(e){e.addToPoned(t,l(t)).then(function(e){e&&$.observable(t).setProperty({addedToPoned:!0})})})},t.props.onVoteClick=function(e){var t=JSON.parse(e.target.dataset.like);a(t?"Cart_Carousel_Recommendations_Like":"Cart_Carousel_Recommendations_Dislike"),$.observable(this).setProperty("voted",!0)},t.props.onItemClick=function(){a("Cart_Carousel_Recommendations_T",this.settings)};var p=this;t.props.updateAnalytics=function(e){var t=$.view(e.target).data,o=this.goods.findIndex(function(e){return e==t})+1,r=this.analiticsCode;p.ctx.root.$analitic.updateState({iid:o,extraL:r,t:n})},t.props.onCarouselShow=function(){a("Cart_Carousel_Recommendations_S",this.settings),i||p.setCache(r,s)}}},onAfterLink:function(){var e=this;this.showWhenInViewPortAsync(_asyncToGenerator(regeneratorRuntime.mark(function t(){var o,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.ctx.root.$analitic.sendEvent("Cart_Carousel_Recommendations_M",{}),e.tagCtx.props.enabled){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,e.ctx.root.$moduleLoader.loadModuleAsync("recommendationCarousel",!1);case 5:return o=t.sent,r=e.getOptions(),e.recommendationsCarousel=new o(e.mainElem[0],r),t.next=10,e.recommendationsCarousel.showAsync();case 10:case"end":return t.stop()}},t)})))},getFromCache:function(e){var t=localStorage.getObject("_basket_recommendations_cache"),o=e.sort().join(",");if(t){var r;if(Date.now()>(null!==(r=t.t)&&void 0!==r?r:0))return localStorage.removeItem("_basket_recommendations_cache"),[];if(t.b===o&&t.r)return t.r}return[]},setCache:function(e,t){Array.isArray(e)&&Array.isArray(t)&&localStorage.putObject("_basket_recommendations_cache",{b:e.sort().join(","),r:t,t:Date.now()+864e5})},showWhenInViewPortAsync:function(e){var t=this;if(this.ctx.root.$apiSupport.intersectionObserver)this.observer=new IntersectionObserver(function(o,r){o.forEach(function(o){var n=o.isIntersecting,s=o.intersectionRatio;(n||s>0)&&(e(),r.unobserve(t.mainElem[0]))})},{rootMargin:"100px"}),this.observer.observe(this.mainElem[0]);else{var o=this.mainElem[0].getBoundingClientRect().top;document.documentElement.clientHeight>o?e():(this._onScrollLoad=this.ctx.root.$helper.throttle(function(){window.pageYOffset>=o-500&&(window.removeEventListener("scroll",t._onScrollLoad),e())},300),window.addEventListener("scroll",this._onScrollLoad))}return this},onUnbind:function(){this.observer&&this.observer.unobserve(this.mainElem[0]),window.removeEventListener("scroll",this._onScrollLoad)}},promotions:{dataBoundOnly:!0,mainElement:".j-b-recommended-goods-wrapper",displayElement:".j-b-recommended-goods-wrapper",template:'<div class="j-b-recommended-goods-wrapper"></div>',onUpdate:!1,init:function(){var e=this;if(!this.inited)return this.inited=!0,(this.ctx.root.$moduleLoader||this.ctx.root.router.$moduleLoader).loadModuleAsync("recommendationCarousel").then(function(t,o){var r,n,s={title:e.tagCtx.props.title,isPromo:!0,sendStats:!0,loop:!1,slideMoveMode:e.tagCtx.props.slideMoveMode,seeAllUrl:e.tagCtx.props.seeAllUrl,sameWindow:null===(r=e.tagCtx.props.sameWindow)||void 0===r||r,fetchUrl:e.tagCtx.props.fetchUrl,analiticsCode:e.tagCtx.props.analiticsCode,showAllSeparate:null!==(n=e.tagCtx.props.showAllSeparate)&&void 0!==n&&n};e.tagCtx.props.visible&&(s.visibleCount=e.tagCtx.props.visible),e.tagCtx.props.targetUrl&&(s.target=e.tagCtx.props.targetUrl);var i={};for(var a in e.tagCtx.props)e.tagCtx.props.hasOwnProperty(a)&&0===a.indexOf("query_")&&(i[a.split("query_")[1]]=e.tagCtx.props[a]);s.query=i,e.recommendationsCarousel=new t(e.mainElem[0],s).showWhenInViewPortAsync()})},onUnbind:function(){var e;null===(e=this.recommendationsCarousel)||void 0===e||e.destroy()}},swiperRecommendationCarousel:{recommendationsBreakpointMap:{full:{1024:{spaceBetween:30,slidesPerGroup:5},1310:{spaceBetween:30,slidesPerGroup:6},1520:{spaceBetween:30,slidesPerGroup:7}},light:{1024:{spaceBetween:30,slidesPerGroup:2},1200:{spaceBetween:30,slidesPerGroup:3}}},init:function(){this.options=this.tagCtx.props,this.swiper=null},onUpdate:!1,onAfterLink:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.ctx.root.$helper.nextTick();case 2:o=e.ctx.root.$apiSupport.nativeLazyImage,e.swiper=new Swiper(e.linkCtx.elem.querySelector(".j-carousel .swiper-container"),{slidesPerView:"auto",spaceBetween:8,watchOverflow:"true",watchSlidesProgress:!o,watchSlidesVisibility:!o,lazy:!o&&{loadPrevNextAmount:5,loadOnTransitionStart:!0},navigation:{nextEl:e.linkCtx.elem.querySelector(".j-carousel .swiper-button-next"),prevEl:e.linkCtx.elem.querySelector(".j-carousel .swiper-button-prev")},breakpoints:e.options.useLight?e.recommendationsBreakpointMap.light:e.recommendationsBreakpointMap.full,on:{imagesReady:function(){o&&e.linkCtx.elem.querySelectorAll("img[data-src]").forEach(function(e){return e.src=e.dataset.src})}},threshold:e.options.swiperThreshold});case 4:case"end":return t.stop()}},t)}))()},onUnbind:function(){var e;null===(e=this.swiper)||void 0===e||e.destroy()}},nativeRecommendationCarousel:{init:function(){this.lazyLoader=null},onAfterLink:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.ctx.root.$moduleLoader.loadModuleAsync("lazyImageLoader");case 2:o=t.sent,e.lazyLoader=new o(e.linkCtx.elem,{rootMargin:"0px 500px",root:e.linkCtx.elem});case 4:case"end":return t.stop()}},t)}))()},onUnbind:function(){var e;null===(e=this.lazyLoader)||void 0===e||e.destroy()}}})}}();

},{"../services/basketRecomendationService":2}],2:[function(require,module,exports){
"use strict";function asyncGeneratorStep(e,r,t,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void t(e)}c.done?r(u):Promise.resolve(u).then(n,o)}function _asyncToGenerator(e){return function(){var r=this,t=arguments;return new Promise(function(n,o){var a=e.apply(r,t);function i(e){asyncGeneratorStep(a,n,o,i,c,"next",e)}function c(e){asyncGeneratorStep(a,n,o,i,c,"throw",e)}i(void 0)})}}var basketRecommendationService=function(){function e(e){this.url="https://basket-recommendation.wildberries.ru/"}return e.prototype.get=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(r){var t,n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(r)&&0!=r.length){e.next=2;break}return e.abrupt("return",[]);case 2:return e.prev=2,e.next=5,fetch(this.url+"v1/basket_recommendation/",{headers:{"content-type":"application/json"},method:"POST",body:JSON.stringify({product_ids:r})});case 5:return n=e.sent,e.next=8,n.json();case 8:return o=e.sent,e.abrupt("return",null!==(t=null==o?void 0:o.recommendation_ids)&&void 0!==t?t:[]);case 12:return e.prev=12,e.t0=e.catch(2),console.error(e.t0),e.abrupt("return",[]);case 16:case"end":return e.stop()}},e,this,[[2,12]])}));return function(r){return e.apply(this,arguments)}}(),e}();module.exports=basketRecommendationService;

},{}]},{},[1]);
